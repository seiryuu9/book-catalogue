import{ai as ae,d as le,aj as ne,p as j,q as Q,s as G,u as X,x as Y,C as oe,K as N,E as Z,H as B,a as r,ak as re,ah as ie,a3 as se,U as ue,v as f,L as de,al as ce,y as me,am as fe,a4 as ve,O as z,a6 as ge,a7 as he,an as be,ad as ye,ae as ke,af as O,b as s,F,l as P,h as V,_ as Ve,j as I,o as v,r as Se,n as _,w as u,Q as we,c as H,t as M}from"./index-DlUQcxRA.js";import{u as Ie}from"./books-Bl32MCfA.js";import{k as Ce,l as K,f as xe,n as Le,o as Re,V as Be}from"./VSelect-C9yIv8yZ.js";import{b as q,V as J,a as W,c as Pe}from"./VCard-ChenOElO.js";const Ae=ae("auth",{state:()=>{const e=localStorage.getItem("currentUser"),a=e?JSON.parse(e):null;return{currentUser:a,isLoggedIn:a!==null}},actions:{login(e,a){const i={username:"demo",password:"demo",avatar:"images/cat.jpg",bio:"I love reading and books and words and and and"};return e===i.username&&a===i.password?(this.currentUser=i,this.isLoggedIn=!0,localStorage.setItem("currentUser",JSON.stringify(i)),!0):!1},logout(){this.currentUser=null,this.isLoggedIn=!1,localStorage.removeItem("currentUser")}}}),De=le({name:"Reviews",props:{clickable:{type:Boolean,default:!1},reviews:{type:Array,default:()=>[]}},data(){return{selectedRating:null,dialog:!1,reviewToDelete:null,injectedBook:j("book",null),injectedBookSlug:j("bookSlug","")}},computed:{auth(){return Ae()},booksStore(){return Ie()},ratingOptions(){return[5,4,3,2,1]},filteredReviews(){const e=this.reviews.length?this.reviews:this.injectedBook?.reviews??[];return e?this.selectedRating?e.filter(a=>a.rating===this.selectedRating):e:[]}},methods:{confirmDelete(e){this.reviewToDelete=e,this.dialog=!0},deleteConfirmed(){!this.injectedBookSlug||!this.reviewToDelete||(this.booksStore.deleteReview(this.injectedBookSlug,this.reviewToDelete),this.reviewToDelete=null,this.dialog=!1)},goToBook(e){if(!this.clickable)return;const a=e;a.bookSlug&&ne.push({name:"book-detail",params:{slug:a.bookSlug}})}}}),Me=G({fullscreen:Boolean,scrollable:Boolean,...re(Le({captureFocus:!0,origin:"center center",scrollStrategy:"block",transition:{component:Re},zIndex:2400,retainFocus:!0}),["disableInitialFocus"])},"VDialog"),Ne=Q()({name:"VDialog",props:Me(),emits:{"update:modelValue":e=>!0,afterEnter:()=>!0,afterLeave:()=>!0},setup(e,a){let{emit:i,slots:g}=a;const h=X(e,"modelValue"),{scopeId:S}=Ce(),t=Y();function d(){i("afterEnter"),(e.scrim||e.retainFocus)&&t.value?.contentEl&&!t.value.contentEl.contains(document.activeElement)&&t.value.contentEl.focus({preventScroll:!0})}function C(){i("afterLeave")}return oe(h,async b=>{b||(await N(),t.value.activatorEl?.focus({preventScroll:!0}))}),Z(()=>{const b=K.filterProps(e),y=B({"aria-haspopup":"dialog"},e.activatorProps),w=B({tabindex:-1},e.contentProps);return r(K,B({ref:t,class:["v-dialog",{"v-dialog--fullscreen":e.fullscreen,"v-dialog--scrollable":e.scrollable},e.class],style:e.style},b,{modelValue:h.value,"onUpdate:modelValue":k=>h.value=k,"aria-modal":"true",activatorProps:y,contentProps:w,height:e.fullscreen?void 0:e.height,width:e.fullscreen?void 0:e.width,maxHeight:e.fullscreen?void 0:e.maxHeight,maxWidth:e.fullscreen?void 0:e.maxWidth,role:"dialog",onAfterEnter:d,onAfterLeave:C},S),{activator:g.activator,default:function(){for(var k=arguments.length,x=new Array(k),c=0;c<k;c++)x[c]=arguments[c];return r(ie,{root:"VDialog"},{default:()=>[g.default?.(...x)]})}})}),xe({},t)}}),Fe=G({name:String,itemAriaLabel:{type:String,default:"$vuetify.rating.ariaLabel.item"},activeColor:String,color:String,clearable:Boolean,disabled:Boolean,emptyIcon:{type:O,default:"$ratingEmpty"},fullIcon:{type:O,default:"$ratingFull"},halfIncrements:Boolean,hover:Boolean,length:{type:[Number,String],default:5},readonly:Boolean,modelValue:{type:[Number,String],default:0},itemLabels:Array,itemLabelPosition:{type:String,default:"top",validator:e=>["top","bottom"].includes(e)},ripple:Boolean,...ke(),...ye(),...be(),...he(),...ge()},"VRating"),Te=Q()({name:"VRating",props:Fe(),emits:{"update:modelValue":e=>!0},setup(e,a){let{slots:i}=a;const{t:g}=se(),{themeClasses:h}=ue(e),S=Y(),t=X(e,"modelValue"),d=f(()=>de(parseFloat(t.value),0,Number(e.length))),C=f(()=>ce(Number(e.length),1)),b=f(()=>C.value.flatMap(l=>e.halfIncrements?[l-.5,l]:[l])),y=me(-1),w=f(()=>b.value.map(l=>{const o=e.hover&&y.value>-1,n=d.value>=l,m=y.value>=l,A=(o?m:n)?e.fullIcon:e.emptyIcon,D=e.activeColor??e.color,R=n||m?D:e.color;return{isFilled:n,isHovered:m,icon:A,color:R}})),k=f(()=>[0,...b.value].map(l=>{function o(){y.value=l}function n(){y.value=-1}function m(){e.disabled||e.readonly||(t.value=d.value===l&&e.clearable?0:l)}return{onMouseenter:e.hover?o:void 0,onMouseleave:e.hover?n:void 0,onClick:m}})),x=f(()=>e.halfIncrements?1+Math.floor(Math.max(0,Number(t.value??0)-.5))*2:Math.floor(Math.max(0,Number(t.value??0)-1)));function c(){S.value?.querySelector('[tabindex="0"]')?.focus()}function p(l){if(e.disabled||e.readonly||l.ctrlKey||l.altKey)return;const o=e.halfIncrements?.5:1;if(l.key==="ArrowRight"){const n=Math.min(Number(e.length),Number(t.value??0)+o);t.value=n,N(()=>c())}if(l.key==="ArrowLeft"){const n=Math.max(0,Number(t.value??0)-o);t.value=n,N(()=>c())}}const ee=fe(),T=f(()=>e.name??`v-rating-${ee}`);function L(l){let{value:o,index:n,showStar:m=!0}=l;const{onMouseenter:$,onMouseleave:A,onClick:D}=k.value[n+1],R=`${T.value}-${String(o).replace(".","-")}`,te=n===x.value,E={color:w.value[n]?.color,density:e.density,disabled:e.disabled,icon:w.value[n]?.icon,ripple:e.ripple,size:e.size,variant:"plain",tabindex:te?0:-1,onKeydown:p};return s(F,null,[s("label",{for:R,class:z({"v-rating__item--half":e.halfIncrements&&o%1>0,"v-rating__item--full":e.halfIncrements&&o%1===0}),onMouseenter:$,onMouseleave:A,onClick:D},[s("span",{class:"v-rating__hidden"},[g(e.itemAriaLabel,o,e.length)]),m?i.item?i.item({...w.value[n],props:E,value:o,index:n,rating:d.value}):r(P,B({"aria-label":g(e.itemAriaLabel,o,e.length)},E),null):void 0]),s("input",{class:"v-rating__hidden",name:T.value,id:R,type:"radio",value:o,checked:d.value===o,tabindex:-1,readonly:e.readonly,disabled:e.disabled},null)])}function U(l){return i["item-label"]?i["item-label"](l):l.label?s("span",null,[l.label]):s("span",null,[V("Â ")])}return Z(()=>{const l=!!e.itemLabels?.length||i["item-label"];return r(e.tag,{class:z(["v-rating",{"v-rating--hover":e.hover,"v-rating--readonly":e.readonly},h.value,e.class]),style:ve(e.style),ref:S},{default:()=>[r(L,{value:0,index:-1,showStar:!1},null),C.value.map((o,n)=>s("div",{class:"v-rating__wrapper"},[l&&e.itemLabelPosition==="top"?U({value:o,index:n,label:e.itemLabels?.[n]}):void 0,s("div",{class:"v-rating__item"},[e.halfIncrements?s(F,null,[r(L,{value:o-.5,index:n*2},null),r(L,{value:o,index:n*2+1},null)]):r(L,{value:o,index:n},null)]),l&&e.itemLabelPosition==="bottom"?U({value:o,index:n,label:e.itemLabels?.[n]}):void 0]))]})}),{}}}),Ue={key:0},$e={class:"text-caption text-grey"},Ee={class:"mt-2"},je={key:1},ze={key:0};function Oe(e,a,i,g,h,S){return v(),I("div",null,[a[7]||(a[7]=s("h3",{class:"my-2"},"Reviews",-1)),r(Be,{modelValue:e.selectedRating,"onUpdate:modelValue":a[0]||(a[0]=t=>e.selectedRating=t),items:e.ratingOptions,label:"Filter by rating",clearable:"",class:"mb-4",density:"compact"},null,8,["modelValue","items"]),e.filteredReviews.length?(v(),I("div",Ue,[(v(!0),I(F,null,Se(e.filteredReviews,t=>(v(),H(q,{key:t.user+t.text+t.rating,class:"mb-3",variant:"outlined",onClick:d=>e.goToBook(t)},{default:u(()=>[!e.clickable&&e.auth.currentUser?.username===t.user?(v(),H(P,{key:0,icon:"mdi-delete",size:"small",variant:"text",color:"error",class:"float-right",onClick:d=>e.confirmDelete(t)},null,8,["onClick"])):_("",!0),r(J,{class:"text-subtitle-1 font-weight-bold"},{default:u(()=>[V(M(t.user),1)]),_:2},1024),r(W,null,{default:u(()=>[r(Te,{"model-value":t.rating,readonly:"",density:"compact"},null,8,["model-value"]),s("p",$e,M(t.title),1),s("p",Ee,M(t.text),1)]),_:2},1024)]),_:2},1032,["onClick"]))),128))])):(v(),I("div",je,[e.filteredReviews.length===0?(v(),I("p",ze," No reviews found. ")):_("",!0)])),r(Ne,{modelValue:e.dialog,"onUpdate:modelValue":a[2]||(a[2]=t=>e.dialog=t),"max-width":"400"},{default:u(()=>[r(q,null,{default:u(()=>[r(J,{class:"headline"},{default:u(()=>[...a[3]||(a[3]=[V("Confirm delete",-1)])]),_:1}),r(W,null,{default:u(()=>[...a[4]||(a[4]=[V(" Are you sure you want to delete this review? ",-1)])]),_:1}),r(Pe,null,{default:u(()=>[r(we),r(P,{text:"",color:"primary",onClick:a[1]||(a[1]=t=>e.dialog=!1)},{default:u(()=>[...a[5]||(a[5]=[V("Cancel",-1)])]),_:1}),r(P,{text:"",color:"error",onClick:e.deleteConfirmed},{default:u(()=>[...a[6]||(a[6]=[V("Delete",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])}const Je=Ve(De,[["render",Oe]]);export{Je as R,Te as V,Ne as a,Ae as u};
