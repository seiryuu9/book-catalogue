import{ai as te,d as ae,aj as le,p as j,q as W,s as Q,u as G,x as X,C as ne,K as N,E as Y,H as B,a as r,ak as oe,ah as re,a3 as ie,U as se,v as f,L as ue,al as de,y as ce,am as me,a4 as fe,O as z,a6 as ve,a7 as ge,an as he,ad as be,ae as ye,af as O,b as s,F,l as P,h as V,_ as ke,j as R,o as k,r as Ve,w as u,Q as Se,c as H,n as we,t as M}from"./index-BBcgGv3D.js";import{u as Ie}from"./books-C6boOhap.js";import{k as Ce,l as K,f as xe,n as Le,o as Re,V as Be}from"./VSelect-DjWAOcod.js";import{b as _,V as q,a as J,c as Pe}from"./VCard-BcGPv6CW.js";const Ae=te("auth",{state:()=>{const e=localStorage.getItem("currentUser"),t=e?JSON.parse(e):null;return{currentUser:t,isLoggedIn:t!==null}},actions:{login(e,t){const i={username:"demo",password:"demo",avatar:"images/cat.jpg",bio:"I love reading and books and words and and and"};return e===i.username&&t===i.password?(this.currentUser=i,this.isLoggedIn=!0,localStorage.setItem("currentUser",JSON.stringify(i)),!0):!1},logout(){this.currentUser=null,this.isLoggedIn=!1,localStorage.removeItem("currentUser")}}}),De=ae({name:"Reviews",props:{clickable:{type:Boolean,default:!1},reviews:{type:Array,default:()=>[]}},data(){return{selectedRating:null,dialog:!1,reviewToDelete:null,injectedBook:j("book",null),injectedBookSlug:j("bookSlug","")}},computed:{auth(){return Ae()},booksStore(){return Ie()},ratingOptions(){return[5,4,3,2,1]},filteredReviews(){const e=this.reviews.length?this.reviews:this.injectedBook?.reviews??[];return e?this.selectedRating?e.filter(t=>t.rating===this.selectedRating):e:[]}},methods:{confirmDelete(e){this.reviewToDelete=e,this.dialog=!0},deleteConfirmed(){!this.injectedBookSlug||!this.reviewToDelete||(this.booksStore.deleteReview(this.injectedBookSlug,this.reviewToDelete),this.reviewToDelete=null,this.dialog=!1)},goToBook(e){if(!this.clickable)return;const t=e;t.bookSlug&&le.push({name:"book-detail",params:{slug:t.bookSlug}})}}}),Me=Q({fullscreen:Boolean,scrollable:Boolean,...oe(Le({captureFocus:!0,origin:"center center",scrollStrategy:"block",transition:{component:Re},zIndex:2400,retainFocus:!0}),["disableInitialFocus"])},"VDialog"),Ne=W()({name:"VDialog",props:Me(),emits:{"update:modelValue":e=>!0,afterEnter:()=>!0,afterLeave:()=>!0},setup(e,t){let{emit:i,slots:v}=t;const g=G(e,"modelValue"),{scopeId:S}=Ce(),a=X();function d(){i("afterEnter"),(e.scrim||e.retainFocus)&&a.value?.contentEl&&!a.value.contentEl.contains(document.activeElement)&&a.value.contentEl.focus({preventScroll:!0})}function I(){i("afterLeave")}return ne(g,async h=>{h||(await N(),a.value.activatorEl?.focus({preventScroll:!0}))}),Y(()=>{const h=K.filterProps(e),b=B({"aria-haspopup":"dialog"},e.activatorProps),w=B({tabindex:-1},e.contentProps);return r(K,B({ref:a,class:["v-dialog",{"v-dialog--fullscreen":e.fullscreen,"v-dialog--scrollable":e.scrollable},e.class],style:e.style},h,{modelValue:g.value,"onUpdate:modelValue":y=>g.value=y,"aria-modal":"true",activatorProps:b,contentProps:w,height:e.fullscreen?void 0:e.height,width:e.fullscreen?void 0:e.width,maxHeight:e.fullscreen?void 0:e.maxHeight,maxWidth:e.fullscreen?void 0:e.maxWidth,role:"dialog",onAfterEnter:d,onAfterLeave:I},S),{activator:v.activator,default:function(){for(var y=arguments.length,C=new Array(y),c=0;c<y;c++)C[c]=arguments[c];return r(re,{root:"VDialog"},{default:()=>[v.default?.(...C)]})}})}),xe({},a)}}),Fe=Q({name:String,itemAriaLabel:{type:String,default:"$vuetify.rating.ariaLabel.item"},activeColor:String,color:String,clearable:Boolean,disabled:Boolean,emptyIcon:{type:O,default:"$ratingEmpty"},fullIcon:{type:O,default:"$ratingFull"},halfIncrements:Boolean,hover:Boolean,length:{type:[Number,String],default:5},readonly:Boolean,modelValue:{type:[Number,String],default:0},itemLabels:Array,itemLabelPosition:{type:String,default:"top",validator:e=>["top","bottom"].includes(e)},ripple:Boolean,...ye(),...be(),...he(),...ge(),...ve()},"VRating"),Te=W()({name:"VRating",props:Fe(),emits:{"update:modelValue":e=>!0},setup(e,t){let{slots:i}=t;const{t:v}=ie(),{themeClasses:g}=se(e),S=X(),a=G(e,"modelValue"),d=f(()=>ue(parseFloat(a.value),0,Number(e.length))),I=f(()=>de(Number(e.length),1)),h=f(()=>I.value.flatMap(l=>e.halfIncrements?[l-.5,l]:[l])),b=ce(-1),w=f(()=>h.value.map(l=>{const o=e.hover&&b.value>-1,n=d.value>=l,m=b.value>=l,A=(o?m:n)?e.fullIcon:e.emptyIcon,D=e.activeColor??e.color,L=n||m?D:e.color;return{isFilled:n,isHovered:m,icon:A,color:L}})),y=f(()=>[0,...h.value].map(l=>{function o(){b.value=l}function n(){b.value=-1}function m(){e.disabled||e.readonly||(a.value=d.value===l&&e.clearable?0:l)}return{onMouseenter:e.hover?o:void 0,onMouseleave:e.hover?n:void 0,onClick:m}})),C=f(()=>e.halfIncrements?1+Math.floor(Math.max(0,Number(a.value??0)-.5))*2:Math.floor(Math.max(0,Number(a.value??0)-1)));function c(){S.value?.querySelector('[tabindex="0"]')?.focus()}function Z(l){if(e.disabled||e.readonly||l.ctrlKey||l.altKey)return;const o=e.halfIncrements?.5:1;if(l.key==="ArrowRight"){const n=Math.min(Number(e.length),Number(a.value??0)+o);a.value=n,N(()=>c())}if(l.key==="ArrowLeft"){const n=Math.max(0,Number(a.value??0)-o);a.value=n,N(()=>c())}}const p=me(),T=f(()=>e.name??`v-rating-${p}`);function x(l){let{value:o,index:n,showStar:m=!0}=l;const{onMouseenter:$,onMouseleave:A,onClick:D}=y.value[n+1],L=`${T.value}-${String(o).replace(".","-")}`,ee=n===C.value,E={color:w.value[n]?.color,density:e.density,disabled:e.disabled,icon:w.value[n]?.icon,ripple:e.ripple,size:e.size,variant:"plain",tabindex:ee?0:-1,onKeydown:Z};return s(F,null,[s("label",{for:L,class:z({"v-rating__item--half":e.halfIncrements&&o%1>0,"v-rating__item--full":e.halfIncrements&&o%1===0}),onMouseenter:$,onMouseleave:A,onClick:D},[s("span",{class:"v-rating__hidden"},[v(e.itemAriaLabel,o,e.length)]),m?i.item?i.item({...w.value[n],props:E,value:o,index:n,rating:d.value}):r(P,B({"aria-label":v(e.itemAriaLabel,o,e.length)},E),null):void 0]),s("input",{class:"v-rating__hidden",name:T.value,id:L,type:"radio",value:o,checked:d.value===o,tabindex:-1,readonly:e.readonly,disabled:e.disabled},null)])}function U(l){return i["item-label"]?i["item-label"](l):l.label?s("span",null,[l.label]):s("span",null,[V("Â ")])}return Y(()=>{const l=!!e.itemLabels?.length||i["item-label"];return r(e.tag,{class:z(["v-rating",{"v-rating--hover":e.hover,"v-rating--readonly":e.readonly},g.value,e.class]),style:fe(e.style),ref:S},{default:()=>[r(x,{value:0,index:-1,showStar:!1},null),I.value.map((o,n)=>s("div",{class:"v-rating__wrapper"},[l&&e.itemLabelPosition==="top"?U({value:o,index:n,label:e.itemLabels?.[n]}):void 0,s("div",{class:"v-rating__item"},[e.halfIncrements?s(F,null,[r(x,{value:o-.5,index:n*2},null),r(x,{value:o,index:n*2+1},null)]):r(x,{value:o,index:n},null)]),l&&e.itemLabelPosition==="bottom"?U({value:o,index:n,label:e.itemLabels?.[n]}):void 0]))]})}),{}}}),Ue={key:0},$e={class:"text-caption text-grey"},Ee={class:"mt-2"},je={key:1,class:"text-center my-4"};function ze(e,t,i,v,g,S){return k(),R("div",null,[t[8]||(t[8]=s("h3",{class:"my-2"},"Reviews",-1)),r(Be,{modelValue:e.selectedRating,"onUpdate:modelValue":t[0]||(t[0]=a=>e.selectedRating=a),items:e.ratingOptions,label:"Filter by rating",clearable:"",class:"mb-4",density:"compact"},null,8,["modelValue","items"]),e.filteredReviews.length?(k(),R("div",Ue,[(k(!0),R(F,null,Ve(e.filteredReviews,a=>(k(),H(_,{key:a.user+a.text+a.rating,class:"mb-3",variant:"outlined",onClick:d=>e.goToBook(a)},{default:u(()=>[!e.clickable&&e.auth.currentUser?.username===a.user?(k(),H(P,{key:0,icon:"mdi-delete",size:"small",variant:"text",color:"error",class:"float-right",onClick:d=>e.confirmDelete(a)},null,8,["onClick"])):we("",!0),r(q,{class:"text-subtitle-1 font-weight-bold"},{default:u(()=>[V(M(a.user),1)]),_:2},1024),r(J,null,{default:u(()=>[r(Te,{"model-value":a.rating,readonly:"",density:"compact"},null,8,["model-value"]),s("p",$e,M(a.title),1),s("p",Ee,M(a.text),1)]),_:2},1024)]),_:2},1032,["onClick"]))),128))])):(k(),R("div",je,[...t[3]||(t[3]=[s("p",null," No reviews found. ",-1)])])),r(Ne,{modelValue:e.dialog,"onUpdate:modelValue":t[2]||(t[2]=a=>e.dialog=a),"max-width":"400"},{default:u(()=>[r(_,null,{default:u(()=>[r(q,{class:"headline"},{default:u(()=>[...t[4]||(t[4]=[V("Confirm delete",-1)])]),_:1}),r(J,null,{default:u(()=>[...t[5]||(t[5]=[V(" Are you sure you want to delete this review? ",-1)])]),_:1}),r(Pe,null,{default:u(()=>[r(Se),r(P,{text:"",color:"primary",onClick:t[1]||(t[1]=a=>e.dialog=!1)},{default:u(()=>[...t[6]||(t[6]=[V("Cancel",-1)])]),_:1}),r(P,{text:"",color:"error",onClick:e.deleteConfirmed},{default:u(()=>[...t[7]||(t[7]=[V("Delete",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])}const qe=ke(De,[["render",ze]]);export{qe as R,Te as V,Ne as a,Ae as u};
