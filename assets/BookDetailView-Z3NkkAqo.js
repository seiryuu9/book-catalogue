import{u as se}from"./books-X99X9mB6.js";import{u as Ce,V as Se,a as Re,R as Be}from"./Reviews-Bjk5h475.js";import{d as ie,p as J,q as Fe,s as Ae,I as Q,u as Pe,v as P,x as V,y as Ie,z as Ne,A as $e,B as He,C as g,D as Te,E as De,G as Me,a,H as _,J as E,K as I,L as je,b as r,F as S,M as X,N as Ue,O as ze,P as _e,_ as re,j as G,n as ue,o as C,w as s,h,l as $,Q as Ee,R as Z,c as ee,V as te,e as Ge,t as N,r as Oe,g as ae,k as oe,f as Le,m as We}from"./index-Bv7RfxhK.js";import{u as qe,a as Ke,b as le,c as ne,f as Ye,m as Je,d as Qe,e as Xe,g as Ze,h as et,i as tt}from"./VSelect-CADWrJSd.js";import{b as at,V as ot,a as lt,c as nt}from"./VCard-DVMkGGx4.js";const st=ie({name:"AddReview",data(){return{rating:0,text:"",dialog:!1,injectedBookSlug:"",injectedBookTitle:""}},computed:{auth(){return Ce()},booksStore(){return se()}},created(){this.injectedBookSlug=J("bookSlug","");const e=J("book",{title:""});this.injectedBookTitle=e.title},methods:{submitReview(){if(!this.auth.currentUser)return;this.booksStore.addReview(this.injectedBookSlug,{title:this.injectedBookTitle,user:this.auth.currentUser.username,rating:this.rating,text:this.text})?(this.rating=0,this.text=""):this.dialog=!0}}}),it=Ae({autoGrow:Boolean,autofocus:Boolean,counter:[Boolean,Number,String],counterValue:Function,prefix:String,placeholder:String,persistentPlaceholder:Boolean,persistentCounter:Boolean,noResize:Boolean,rows:{type:[Number,String],default:5,validator:e=>!isNaN(parseFloat(e))},maxHeight:{type:[Number,String],validator:e=>!isNaN(parseFloat(e))},maxRows:{type:[Number,String],validator:e=>!isNaN(parseFloat(e))},suffix:String,modelModifiers:Object,...Xe(),...Qe(),...Je()},"VTextarea"),rt=Fe()({name:"VTextarea",directives:{vIntersect:Q},inheritAttrs:!1,props:it(),emits:{"click:control":e=>!0,"mousedown:control":e=>!0,"update:focused":e=>!0,"update:modelValue":e=>!0,"update:rows":e=>!0},setup(e,t){let{attrs:w,emit:y,slots:d}=t;const i=Pe(e,"modelValue"),{isFocused:l,focus:H,blur:R}=qe(e),{onIntersect:de}=et(e),ce=P(()=>typeof e.counterValue=="function"?e.counterValue(i.value):(i.value||"").toString().length),fe=P(()=>{if(w.maxlength)return w.maxlength;if(!(!e.counter||typeof e.counter!="number"&&typeof e.counter!="string"))return e.counter}),O=V(),B=V(),L=Ie(""),x=V(),T=V(0),{platform:me}=Ne(),F=Ke(e),ve=P(()=>e.persistentPlaceholder||l.value||e.active);function D(){F.isSuppressing.value&&F.update(),x.value!==document.activeElement&&x.value?.focus(),l.value||H()}function ge(o){D(),y("click:control",o)}function he(o){y("mousedown:control",o)}function xe(o){o.stopPropagation(),D(),I(()=>{i.value="",_e(e["onClick:clear"],o)})}function be(o){const n=o.target;if(!e.modelModifiers?.trim){i.value=n.value;return}const u=n.value,k=n.selectionStart,m=n.selectionEnd;i.value=u,I(()=>{let v=0;u.trimStart().length===n.value.length&&(v=u.length-n.value.length),k!=null&&(n.selectionStart=k-v),m!=null&&(n.selectionEnd=m-v)})}const b=V(),p=V(Number(e.rows)),M=P(()=>["plain","underlined"].includes(e.variant));$e(()=>{e.autoGrow||(p.value=Number(e.rows))});function f(){I(()=>{if(!x.value)return;if(me.value.firefox){T.value=12;return}const{offsetWidth:o,clientWidth:n}=x.value;T.value=Math.max(0,o-n)}),e.autoGrow&&I(()=>{if(!b.value||!B.value)return;const o=getComputedStyle(b.value),n=getComputedStyle(B.value.$el),u=parseFloat(o.getPropertyValue("--v-field-padding-top"))+parseFloat(o.getPropertyValue("--v-input-padding-top"))+parseFloat(o.getPropertyValue("--v-field-padding-bottom")),k=b.value.scrollHeight,m=parseFloat(o.lineHeight),v=Math.max(parseFloat(e.rows)*m+u,parseFloat(n.getPropertyValue("--v-input-control-height"))),j=e.maxHeight?parseFloat(e.maxHeight):parseFloat(e.maxRows)*m+u||1/0,c=je(k??0,v,j);p.value=Math.floor((c-u)/m),L.value=E(c)})}He(f),g(i,f),g(()=>e.rows,f),g(()=>e.maxHeight,f),g(()=>e.maxRows,f),g(()=>e.density,f),g(p,o=>{y("update:rows",o)});let A;return g(b,o=>{o?(A=new ResizeObserver(f),A.observe(b.value)):A?.disconnect()}),Te(()=>{A?.disconnect()}),De(()=>{const o=!!(d.counter||e.counter||e.counterValue),n=!!(o||d.details),[u,k]=Me(w),{modelValue:m,...v}=le.filterProps(e),j={...ne.filterProps(e),"onClick:clear":xe};return a(le,_({ref:O,modelValue:i.value,"onUpdate:modelValue":c=>i.value=c,class:["v-textarea v-text-field",{"v-textarea--prefixed":e.prefix,"v-textarea--suffixed":e.suffix,"v-text-field--prefixed":e.prefix,"v-text-field--suffixed":e.suffix,"v-textarea--auto-grow":e.autoGrow,"v-textarea--no-resize":e.noResize||e.autoGrow,"v-input--plain-underlined":M.value},e.class],style:[{"--v-textarea-max-height":e.maxHeight?E(e.maxHeight):void 0,"--v-textarea-scroll-bar-width":E(T.value)},e.style]},u,v,{centerAffix:p.value===1&&!M.value,focused:l.value}),{...d,default:c=>{let{id:U,isDisabled:W,isDirty:q,isReadonly:ke,isValid:Ve,hasDetails:we}=c;return a(ne,_({ref:B,style:{"--v-textarea-control-height":L.value},onClick:ge,onMousedown:he,"onClick:prependInner":e["onClick:prependInner"],"onClick:appendInner":e["onClick:appendInner"]},j,{id:U.value,active:ve.value||q.value,labelId:`${U.value}-label`,centerAffix:p.value===1&&!M.value,dirty:q.value||e.dirty,disabled:W.value,focused:l.value,details:we.value,error:Ve.value===!1}),{...d,default:ye=>{let{props:{class:K,...Y},controlRef:pe}=ye;return r(S,null,[e.prefix&&r("span",{class:"v-text-field__prefix"},[e.prefix]),X(r("textarea",_({ref:z=>x.value=pe.value=z,class:K,value:i.value,onInput:be,autofocus:e.autofocus,readonly:ke.value,disabled:W.value,placeholder:e.placeholder,rows:e.rows,name:F.fieldName.value,autocomplete:F.fieldAutocomplete.value,onFocus:D,onBlur:R,"aria-labelledby":`${U.value}-label`},Y,k),null),[[Q,{handler:de},null,{once:!0}]]),e.autoGrow&&X(r("textarea",{class:ze([K,"v-textarea__sizer"]),id:`${Y.id}-sizer`,"onUpdate:modelValue":z=>i.value=z,ref:b,readonly:!0,"aria-hidden":"true"},null),[[Ue,i.value]]),e.suffix&&r("span",{class:"v-text-field__suffix"},[e.suffix])])}})},details:n?c=>r(S,null,[d.details?.(c),o&&r(S,null,[r("span",null,null),a(Ze,{active:e.persistentCounter||l.value,value:ce.value,max:fe.value,disabled:e.disabled},d.counter)])]):void 0})}),Ye({},O,B,x)}}),ut={key:0};function dt(e,t,w,y,d,i){return e.auth.isLoggedIn?(C(),G("div",ut,[t[8]||(t[8]=r("h3",{class:"my-4"},"Add Review",-1)),a(Se,{modelValue:e.rating,"onUpdate:modelValue":t[0]||(t[0]=l=>e.rating=l),density:"compact"},null,8,["modelValue"]),a(rt,{modelValue:e.text,"onUpdate:modelValue":t[1]||(t[1]=l=>e.text=l),label:"Your review",rows:"3"},null,8,["modelValue"]),a($,{color:"primary",class:"mt-3",disabled:!e.rating||!e.text,onClick:e.submitReview},{default:s(()=>[...t[4]||(t[4]=[h(" Submit review ",-1)])]),_:1},8,["disabled","onClick"]),a(Re,{persistent:"",modelValue:e.dialog,"onUpdate:modelValue":t[3]||(t[3]=l=>e.dialog=l),"max-width":"400"},{default:s(()=>[a(at,null,{default:s(()=>[a(ot,{class:"headline"},{default:s(()=>[...t[5]||(t[5]=[h("Oops!",-1)])]),_:1}),a(lt,null,{default:s(()=>[...t[6]||(t[6]=[h("You've already reviewed this book.",-1)])]),_:1}),a(nt,null,{default:s(()=>[a(Ee),a($,{color:"primary",text:"",onClick:t[2]||(t[2]=l=>e.dialog=!1)},{default:s(()=>[...t[7]||(t[7]=[h("OK",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])])):ue("",!0)}const ct=re(st,[["render",dt]]),ft=ie({name:"BookDetailView",components:{Reviews:Be,AddReview:ct},props:{slug:{type:String,required:!0}},computed:{booksStore(){return se()},book(){return this.booksStore.getBookBySlug(this.slug)}},watch:{book:{immediate:!0,handler(e){e&&(Z("book",e),Z("bookSlug",e.slug))}},"$route.params.slug":{immediate:!0,handler(e){this.booksStore.getBookBySlug(e)}}}}),mt={class:"text-subtitle-1 my-3"},vt={class:"my-2"},gt={class:"d-flex justify-end"};function ht(e,t,w,y,d,i){const l=oe("Reviews"),H=oe("AddReview");return C(),G(S,null,[a($,{variant:"text",color:"primary",to:"/books","prepend-icon":"mdi-arrow-left",class:"mb-4"},{default:s(()=>[...t[0]||(t[0]=[h(" Back ",-1)])]),_:1}),e.book?(C(),ee(We,{key:0},{default:s(()=>[a(Le,null,{default:s(()=>[a(te,{cols:"12",md:"4"},{default:s(()=>[a(Ge,{src:`/${e.book.image}`},null,8,["src"])]),_:1}),a(te,{cols:"12",md:"8"},{default:s(()=>[r("h1",null,N(e.book.title),1),(C(!0),G(S,null,Oe(e.book.genre,R=>(C(),ee(tt,{key:R,color:"primary",variant:"outlined",class:"ma-1"},{default:s(()=>[h(N(R),1)]),_:2},1024))),128)),r("h3",mt,"Author: "+N(e.book.author),1),r("p",vt,N(e.book.description),1),r("div",gt,[a($,{variant:"text",color:"primary",href:e.book.source,target:"_blank"},{default:s(()=>[...t[1]||(t[1]=[h(" Source ",-1)])]),_:1},8,["href"])]),a(ae,{class:"my-6"}),a(l),a(ae,{class:"my-6"}),a(H)]),_:1})]),_:1})]),_:1})):ue("",!0)],64)}const yt=re(ft,[["render",ht]]);export{yt as default};
